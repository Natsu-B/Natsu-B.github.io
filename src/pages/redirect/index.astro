---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout
  title="Redirect | Natsu-B"
  description="クエリ ?to= のURLへ転送するユーティリティページ。"
>
  <section class="panel px-6 py-6 sm:px-8 sm:py-8">
    <h1 class="text-2xl font-bold tracking-tight text-slate-800 sm:text-3xl">Redirect</h1>
    <p class="mt-3 text-sm leading-7 text-slate-600 sm:text-base">
      使い方: <code>/redirect/?to=https%3A%2F%2Fexample.com</code>
    </p>

    <div id="redirect-box" class="mt-5 rounded-xl border border-slate-200 bg-slate-50/70 p-4 sm:p-5">
      <p class="text-sm leading-7 text-slate-600 sm:text-base">
        転送先が指定されていません。<code>?to=</code> を付けてアクセスしてください。
      </p>
      <ul class="mt-3 list-disc pl-5 text-sm leading-7 text-slate-600 sm:text-base">
        <li>
          <a href="/redirect/?to=https%3A%2F%2Fgithub.com%2FNatsu-B">
            example: GitHub
          </a>
        </li>
      </ul>
    </div>
  </section>

  <script is:inline>
    const box = document.getElementById("redirect-box");
    const query = new URLSearchParams(window.location.search);
    const to = query.get("to");

    if (box && to) {
      let decoded = to;
      try {
        decoded = decodeURIComponent(to);
      } catch {
        decoded = to;
      }

      try {
        const target = new URL(decoded);
        box.replaceChildren();

        const line1 = document.createElement("p");
        line1.className = "text-sm leading-7 text-slate-600 sm:text-base";
        line1.textContent = "転送します…";

        const line2 = document.createElement("p");
        line2.className = "mt-2 text-sm break-all text-slate-700";
        const anchor = document.createElement("a");
        anchor.href = target.toString();
        anchor.textContent = target.toString();
        line2.append(anchor);

        const line3 = document.createElement("p");
        line3.className = "mt-2 text-sm text-slate-500";
        line3.textContent = "自動で移動しない場合はリンクをクリックしてください。";

        box.append(line1, line2, line3);
        window.setTimeout(() => window.location.replace(target.toString()), 250);
      } catch {
        box.replaceChildren();
        const line = document.createElement("p");
        line.className = "text-sm leading-7 text-rose-600";
        line.textContent = "`to` パラメータのURLが不正です。";
        box.append(line);
      }
    }
  </script>
</BaseLayout>
