---
import ArticleCard from "../../components/ArticleCard.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
  getPublishedArticles,
  getTagSummaries,
  hasTag,
  type Article,
  type TagSummary,
} from "../../lib/articles";

interface Props {
  tag: TagSummary;
  articles: Article[];
}

export async function getStaticPaths() {
  const articles = await getPublishedArticles();
  const tags = getTagSummaries(articles);

  return tags.map((tag) => ({
    params: { tag: tag.slug },
    props: {
      tag,
      articles: articles.filter((article) => hasTag(article, tag.value)),
    },
  }));
}

const { tag, articles } = Astro.props as Props;
---

<BaseLayout
  title={`#${tag.label} | Tags | ほたるいか`}
  description={`タグ「${tag.label}」の記事一覧。`}
>
  <section class="panel px-6 py-6 sm:px-8 sm:py-8">
    <p class="text-sm text-slate-500">Tag</p>
    <h1 class="mt-1 text-2xl font-bold tracking-tight text-slate-800 sm:text-3xl">#{tag.label}</h1>
    <p class="mt-3 text-sm leading-7 text-slate-600 sm:text-base">{tag.count}件の記事があります。</p>
    <a href="/tags/" class="mt-4 inline-flex text-sm font-medium">すべてのタグへ戻る</a>
  </section>

  <section class="mt-6 space-y-4">
    {articles.map((article) => <ArticleCard article={article} />)}
    {
      articles.length === 0 && (
        <p class="panel p-5 text-sm text-slate-600">このタグの記事はまだありません。</p>
      )
    }
  </section>
</BaseLayout>
